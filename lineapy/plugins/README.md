# Linea Plugin architecture

The main purpose of `lineapy` is to extract ("slice") the source code necesary and sufficient to (re)create objects or variables, which we call _artifacts_.
But what to do with this code after it's extracted from the original user's code? Saving to a `.py` file is the simplest scenario, but often a user wants to use the sliced code in a specilized execution system, for example a workflow automation toool like Airflow.

This is where plugins come into play. The `BasePlugin` class handles the final formatting, linting and saving the code to generate one ore several artifacts as a well-formated Python module. *TODO* Generate unit tests for this module.

More advanced plugins, such as `AirflowPlugin` start with createing a Python module as well, hence their classes extend the `BasePlugin` producing additional files as an output.

## Airflow Plugin

Airflow DAG is a `.py` file in itself, which uses `AirflowRunner` and `AirflowConfig` classes internally to load and execute the python module generated by it's `BasePlugin` superclass. Linea creates it largely automatically when a user follows this API:

```
slice_names = ["p value", "y"]
func_name = "sliced_housing_dag"
airflow_task_dependencies = "'p value' >> 'y'"
ap = AirflowPlugin(tracer)
ap.sliced_airflow_dag(slice_names, func_name, airflow_task_dependencies)
```

In the example above `slice_names` is list of names of the artifacts that you want to include as Airflow DAG tasks. `airflow_task_dependencies` is the dependency relation between these classes (see the Airflow [docs](https://airflow.apache.org/docs/apache-airflow/stable/concepts/dags.html#task-dependencies) for the format of this string) and `func_name` is the name you want to give to the resulting DAG `.py` file.

`tracer` is the `Tracer` object for the Linea session in which these artifacts had been saved (see the main lineapy README).

After executing `sliced_airflow_dag` as in this example, three files will be produced:
- `sliced_housing_dag.py` - The Airflow DAG file
- `requirements.txt` - Python packages required to run this DAG and the artifct-producing tasks within it
- `Dockerfile` - An example Dockerfile to produce a minimal container that can successfuly exacute this DAG
